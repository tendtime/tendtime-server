
%h1= @project.name
%div
  %span.pull-left
    %span.sub-heading= @project.description
  %span.pull-right
    %span.total
      Total Project Cost:
      ="$#{@total_price}"
%table.table
  - @project_requirements.each do |family|
    %tr
      %th(colspan=7)= family['name']
    - family['types'].each do |type|
      %tr{data: {product: type.to_json}}
        %td(width="5px")
        %td= type['name']
        %td= type['quantity']
        %td= type['product'].price_per_unit
        %td= number_with_precision((type['quantity'].to_i * type['product'].price_per_unit), precision: 2)
        %td= time_ago_in_words type['product'].updated_at
        %td
          %a.btn.btn-sm.btn-primary.do-enquire
            %i.glyphicon.glyphicon-shopping-cart

= form_tag project_path(@project), method: :patch, multipart: true do
  = file_field_tag 'project[requirements]'
  = submit_tag 'upload'

- if @project_requirements.any?
  %div{ id: 'piechart' }

:javascript
  $(function () {
    $('.do-enquire').click(function(e) {
      e.preventDefault();
      var $trEl = $(this).closest('tr');
      var product = $trEl.data('product');
      var johnyMessages = [
        "Design is a word that's come to mean so much that it's also a word that has come to mean nothing.",
        "Itâ€™s very easy to be different, but very difficult to be better.",
        "Very often design is the most immediate way of defining what products become in people's minds."
        ]
      var message = "<p>Johny said: " + johnyMessages[Math.floor(Math.random() * johnyMessages.length)] + "</p>" +
        "<p>You are going buy the best " + product.name + " ever made!</p>" +
        "<p>Thank you ! We love you</p>"
      $trEl.addClass('success');
      $(this).addClass('disabled');
      bootbox.alert(message);
    })
      $('#piechart').highcharts({
          chart: {
              plotBackgroundColor: null,
              plotBorderWidth: null,
              plotShadow: false
          },
          title: {
              text: 'Price Breakdown'
          },
          tooltip: {
              pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
          },
          plotOptions: {
              pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  dataLabels: {
                      enabled: true,
                      format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                      style: {
                          color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                      }
                  }
              }
          },
          series: [{
              type: 'pie',
              name: 'Product',
              data: #{ @chart_data.to_json }
          }]
      });
  });
